:root {
  --bg: #030314;
  --star: #7dd3fc;
  --accent: #8b5cf6;
  --accent-2: #22d3ee;
  --light: #e6e6ff;
  --dark: #0f1026;
  --good: #22c55e;
  --warn: #f59e0b;
  --danger: #ef4444;
  --tile-inner: rgba(0,0,0,.35);
  --focus: #ffffff;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--light);
  background: radial-gradient(1200px 800px at 70% 10%, #0a0b2a 0%, var(--bg) 60%) fixed;
  overflow-x: hidden;
}

#stars-bg {
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background-image: url('assets/stars.svg');
  background-size: 600px; opacity: 0.45; mix-blend-mode: screen;
}

.topbar {
  position: sticky; top: 0; z-index: 10;
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px; background: rgba(12,12,28,.7); backdrop-filter: blur(6px);
  border-bottom: 1px solid rgba(255,255,255,.06);
}
.topbar h1 { margin: 0; font-size: 18px; letter-spacing: .1em; }
.controls-group { display: flex; gap: 8px; }
button {
  background: linear-gradient(135deg, rgba(139,92,246,.2), rgba(34,211,238,.15));
  color: var(--light);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 10px; padding: 8px 12px; cursor: pointer;
  text-shadow: 0 0 12px rgba(141, 90, 247, .6);
}
button:hover { box-shadow: 0 0 0 2px rgba(141,90,247,.25) inset; }

.layout {
  z-index: 1; position: relative;
  display: grid; grid-template-columns: 280px 1fr; gap: 16px; padding: 16px; align-items: start;
}
.toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background: rgba(239,68,68,.9); color: #fff; padding: 8px 12px; border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,.3); z-index: 50; opacity: 0; transition: opacity .2s ease; }
.toast.show { opacity: 1; }

/* Hide AI widgets in Local mode */
[data-mode="local"] .panel-block h2:has(#ai-diff-label),
[data-mode="local"] .panel-block:has(#ai-timer-text) { display: none; }

.side-panel { display: flex; flex-direction: column; gap: 12px; }
.panel-block {
  background: rgba(12,12,28,.6); border: 1px solid rgba(255,255,255,.06);
  border-radius: 14px; padding: 12px;
}
.panel-block h2, .panel-block h3 { margin: 0 0 8px 0; font-size: 14px; opacity: .9; }
.toggle { display: flex; align-items: center; gap: 8px; opacity: .9; }

.timer { display:flex; align-items:center; gap: 10px; }
.timer .bar { flex:1; height: 10px; background: rgba(255,255,255,.08); border-radius: 999px; overflow: hidden; }
.timer .bar > div { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); box-shadow: 0 0 18px var(--accent); }
.timer.thinking .bar > div { background: linear-gradient(90deg, var(--warn), var(--accent-2)); box-shadow: 0 0 18px var(--warn); }

.board-wrap { position: relative; display: grid; place-items: center; }
.board {
  width: min(90vw, 90vh); aspect-ratio: 1/1; max-width: 720px;
  background: radial-gradient(600px 600px at 50% 50%, rgba(34,211,238,.08), rgba(139,92,246,.06)),
              linear-gradient(135deg, rgba(34,211,238,.04), rgba(139,92,246,.04));
  border: 1px solid rgba(255,255,255,.1);
  border-radius: 16px; padding: 8px; display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr);
  box-shadow: 0 0 40px rgba(139, 92, 246, .25), inset 0 0 40px rgba(34, 211, 238, .12);
}
.square { position: relative; }
.capture-note { position: absolute; top: 8px; left: 8px; font-size: 12px; opacity: .9; background: rgba(0,0,0,.4); padding: 4px 6px; border-radius: 8px; border: 1px solid rgba(255,255,255,.12); }
.capture-required .square:not(.capture-dot):not(.glow) { opacity: .6; }
.light { background: rgba(255,255,255,.04); box-shadow: inset 0 6px 18px var(--tile-inner); }
.dark { background: rgba(0,0,0,.35); box-shadow: inset 0 8px 22px var(--tile-inner); }
.square.glow::after {
  content: ""; position: absolute; inset: 8%; border-radius: 10px;
  box-shadow: 0 0 0 2px rgba(34,211,238,.6), 0 0 24px rgba(34,211,238,.45);
}
.move-dot::after { content: ""; position: absolute; inset: 35%; border-radius: 50%; background: rgba(34,211,238,.75); box-shadow: 0 0 16px rgba(34,211,238,.75); }
.capture-dot::after { content: ""; position: absolute; inset: 30%; border-radius: 50%; background: rgba(239,68,68,.9); box-shadow: 0 0 16px rgba(239,68,68,.75); }

.piece { display: grid; place-items: center; width: 100%; height: 100%; }
.piece img { width: 70%; height: 70%; filter: drop-shadow(0 0 14px rgba(141,90,247,.6)); transition: transform .18s ease, filter .18s ease; }
.piece.light img { filter: drop-shadow(0 0 14px rgba(255,255,255,.35)) drop-shadow(0 0 10px rgba(34,211,238,.4)); }

.piece.king img { animation: kingPulse 3s ease-in-out infinite; }
@keyframes kingPulse { 0%,100%{ filter: drop-shadow(0 0 14px rgba(255,255,255,.45)); } 50%{ filter: drop-shadow(0 0 22px rgba(255,255,255,.75)); } }

#countdown {
  position: absolute; inset: 0; display: grid; place-items: center; backdrop-filter: blur(2px);
  color: #fff; font-size: clamp(32px, 10vw, 80px); text-shadow: 0 0 30px rgba(255,255,255,.6);
}
#countdown[hidden] { display: none; }

.ai-thinking { position: absolute; top: 8px; right: 8px; display: flex; align-items: center; gap: 8px; padding: 6px 8px; background: rgba(12,12,28,.6); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; }
.ai-thinking img { width: 28px; height: 28px; animation: slowSpin 6s linear infinite; filter: drop-shadow(0 0 8px rgba(34,211,238,.5)); }
@keyframes slowSpin { from{ transform: rotate(0deg);} to{ transform: rotate(360deg);} }
.ai-thinking .ring { width: 28px; height: 28px; }
.ai-thinking .bg { fill: none; stroke: rgba(255,255,255,.15); stroke-width: 3; }
.ai-thinking .fg { fill: none; stroke: var(--accent-2); stroke-width: 3; stroke-linecap: round; stroke-dasharray: 100, 100; stroke-dashoffset: 0; transition: stroke-dashoffset .2s linear; }

.particles { position: absolute; inset: 0; pointer-events: none; }

/* Splash */
.splash { position: fixed; inset: 0; display: grid; place-items: center; background: radial-gradient(1000px 700px at 50% 30%, rgba(34,211,238,.08), rgba(0,0,0,.8)), var(--bg); z-index: 20; }
.splash[aria-hidden="true"] { display: none; }
.splash .logo { font-size: clamp(22px, 5vw, 44px); letter-spacing: .12em; text-shadow: 0 0 24px rgba(141,90,247,.6); }
.splash .logo span { color: var(--accent-2); }
.splash .splash-anim img { width: 120px; height: 120px; animation: slowSpin 12s linear infinite; filter: drop-shadow(0 0 12px rgba(34,211,238,.6)); }
.splash .splash-actions { display: flex; gap: 10px; margin-top: 14px; }
.splash .splash-actions .primary { box-shadow: 0 0 0 2px rgba(34,211,238,.3) inset; }
.profile-link { display: inline-flex; align-items: center; gap: 8px; opacity: .9; margin-top: 10px; cursor: pointer; }
.profile-link img { width: 16px; height: 16px; }

/* Endgame */
dialog#endgame-dialog::backdrop { background: rgba(0,0,0,.5); }
.endgame { min-width: 300px; background: rgba(12,12,28,.96); border: 1px solid rgba(255,255,255,.12); border-radius: 12px; padding: 16px; text-align: center; }
.endgame .result-icon img { width: 48px; height: 48px; filter: drop-shadow(0 0 10px rgba(34,211,238,.6)); }

/* Accessibility */
button:focus-visible, select:focus-visible { outline: 2px solid var(--focus); outline-offset: 2px; }

/* Themes */
[data-theme="cosmic"] { --accent: #8b5cf6; --accent-2: #22d3ee; --bg: #030314; }
[data-theme="solar"] { --accent: #fb923c; --accent-2: #fde047; --bg: #1a0f05; }
[data-theme="nebula"] { --accent: #c084fc; --accent-2: #60a5fa; --bg: #16051f; }

dialog::backdrop { background: rgba(0,0,0,.4); }
.settings-form { min-width: 280px; background: rgba(12,12,28,.95); color: var(--light); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; padding: 16px; }
.settings-form h2 { margin-top: 0; }
.settings-form label { display: grid; gap: 6px; margin: 8px 0; }
.settings-form menu { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }

.readme { padding: 16px; max-width: 900px; margin: 24px auto; opacity: .95; }
.readme h2 { margin-top: 0; }

@media (max-width: 900px) {
  .layout { grid-template-columns: 1fr; }
  .board { width: min(96vw, 96vh); }
}


